<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments.html :: head"></head>
<body class="bg-warning">
<div th:replace="fragments.html :: main-nav"></div>

<div class="container">
    <div class="row mt-5 justify-content-center">
        <div class="col-2">
            <div th:replace="fragments.html :: menu-setting (currentMenu='tag')"></div>

        </div>
        <div class="col-7">
            <div class="row-12">
                <h3 class="col-sm-12">좋아하는 서클 키워드</h3>
            </div>
            <div class="row">
                <div class="col-10">
                    <div class="alert alert-info" role="alert">
                        활동하고 싶은 서클을 입력하면, 나중에 해당 키워드의 서클이 생길 때, 알림을 받을 수 있음
                    </div>
                    <input type="text" id="tag" name="tag" th:value="${#strings.listJoin(tag,',')}"/>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="/node_modules/@yaireo/tagify/dist/tagify.min.js"></script>
<script>

$(function(){
    var input = document.querySelector('input[name=tag]'),
    tagify = new Tagify(input, {
        pattern             : /^.{0,10}$/,
        delimiters          : ",| ",        // add new tags when a comma or a space character is entered
        keepInvalidTags     : true,         // do not remove invalid tags (but keep them marked as invalid)
        editTags            : 1,            // single click to edit a tag
        maxTags             : 6,
        transformTag        : transformTag,
        backspace           : "edit",
        placeholder         : "type something",
        dropdown : {
            enabled: 3,
        }
    })

    function getRandomColor(){
     function rand(min, max) {
        return min + Math.random() * (max - min);
    }

        var h = rand(1, 360)|0,
            s = rand(40, 70)|0,
            l = rand(65, 72)|0;

        return 'hsl(' + h + ',' + s + '%,' + l + '%)';
    }

    function transformTag( tagData ){
        tagData.style = "--tag-bg:" + getRandomColor();

        if( tagData.value.toLowerCase() == 'shit' )
           tagData.value = 's✲✲t'
    }


    tagify.on('add', tagAjaxReq('/add'));


    tagify.on('invalid', function(e){
        console.log(e, e.detail);
    });
})


    function tagAjaxReq(url){
    let $tags = $('input[name=tag]').val();
    let jsonFormat = {"tagName" : $tags}
         $.ajax({
            method : 'post',
            url : '/settings/tag'+url,
            data : JSON.stringify(jsonFormat),
            dataType : 'json'
        }).done(function(succ){
            alert(succ);
        }).fail(function(fail){
            alert('fuck '+fail);
        })
    }
</script>
</body>
</html>